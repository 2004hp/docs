---
layout: example-app 
title: "Todo list using RethinkDB, Bottle, and Ember.js"
github_url: "https://github.com/rethinkdb/rethinkdb-example-bottle-ember-todo"
active: docs
docs_active: examples
permalink: docs/examples/bottle-ember-todo/
---
<div id="background"></div>
<table cellspacing=0 cellpadding=0>
    <thead>
        <tr>
            <th class=docs><h1>todo.py</h1></th>
            <th class=code></th>
        </tr>
    </thead>
    <tbody>
        <tr id='section-1'>
            <td class=docs>
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-1">&#182;</a>
                </div>
                <p>A demo web application in the spirit of
<a href="http://addyosmani.github.com/todomvc/">TodoMVC</a> showing how to use
<strong>RethinkDB as a backend for Bottle and Ember.js applications</strong>.</p>

<p>For details about the complete stack, installation, and running the
app see the
<a href="https://github.com/rethinkdb/rethinkdb-example-bottle-ember-todo">README</a>.</p>
            </td>
            <td class=code>
                <div class='highlight'><pre><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="kn">import</span> <span class="nn">bottle</span>
<span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">static_file</span><span class="p">,</span> <span class="n">request</span>

<span class="kn">import</span> <span class="nn">rethinkdb</span> <span class="kn">as</span> <span class="nn">r</span>
<span class="kn">from</span> <span class="nn">rethinkdb.errors</span> <span class="kn">import</span> <span class="n">RqlRuntimeError</span><span class="p">,</span> <span class="n">RqlDriverError</span></pre></div>
            </td>
        </tr>
        <tr id='section-Connection_details'>
            <td class=docs>
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-Connection_details">&#182;</a>
                </div>
                <h3>Connection details</h3>
            </td>
            <td class=code>
                <div class='highlight'><pre></pre></div>
            </td>
        </tr>
        <tr id='section-3'>
            <td class=docs>
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-3">&#182;</a>
                </div>
                <p>We will use these settings later in the code to connect to the
RethinkDB server.</p>
            </td>
            <td class=code>
                <div class='highlight'><pre><span class="n">RDB_HOST</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;RDB_HOST&#39;</span><span class="p">,</span> <span class="s">&#39;localhost&#39;</span><span class="p">)</span>
<span class="n">RDB_PORT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;RDB_PORT&#39;</span><span class="p">,</span> <span class="mi">28015</span><span class="p">)</span>
<span class="n">TODO_DB</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;TODO_DB&#39;</span><span class="p">,</span> <span class="s">&#39;todoapp&#39;</span><span class="p">)</span></pre></div>
            </td>
        </tr>
        <tr id='section-Setting_up_the_app_database'>
            <td class=docs>
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-Setting_up_the_app_database">&#182;</a>
                </div>
                <h3>Setting up the app database</h3>
            </td>
            <td class=code>
                <div class='highlight'><pre></pre></div>
            </td>
        </tr>
        <tr id='section-5'>
            <td class=docs>
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-5">&#182;</a>
                </div>
                <p>The app will use a table <code>todos</code> in the database specified by the
<code>TODO_DB</code> variable (defaults to <code>todoapp</code>).  We&#39;ll create the database and table here using
<a href="http://www.rethinkdb.com/api/#py:manipulating_databases-db_create"><code>db_create</code></a>
and
<a href="http://www.rethinkdb.com/api/#py:manipulating_tables-table_create"><code>table_create</code></a> commands.</p>
            </td>
            <td class=code>
                <div class='highlight'><pre><span class="k">def</span> <span class="nf">dbSetup</span><span class="p">():</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">RDB_HOST</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">RDB_PORT</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span><span class="o">.</span><span class="n">db_create</span><span class="p">(</span><span class="n">TODO_DB</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>
        <span class="n">r</span><span class="o">.</span><span class="n">db</span><span class="p">(</span><span class="n">TODO_DB</span><span class="p">)</span><span class="o">.</span><span class="n">table_create</span><span class="p">(</span><span class="s">&#39;todos&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;Database setup completed. Now run the app without --setup: `python todo.py`&#39;</span>
    <span class="k">except</span> <span class="n">RqlRuntimeError</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;App database already exists. Run the app without --setup: `python todo.py`&#39;</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></pre></div>
            </td>
        </tr>
        <tr id='section-Managing_connections'>
            <td class=docs>
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-Managing_connections">&#182;</a>
                </div>
                <h3>Managing connections</h3>
            </td>
            <td class=code>
                <div class='highlight'><pre></pre></div>
            </td>
        </tr>
        <tr id='section-7'>
            <td class=docs>
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-7">&#182;</a>
                </div>
                <p>The pattern we&#39;re using for managing database connections is to have <strong>a connection per request</strong>. 
We&#39;re using Bottle&#39;s <code>@bottle.hook(&#39;before_request&#39;)</code> and <code>@bottle.hook(&#39;after_request&#39;)</code> for 
<a href="http://www.rethinkdb.com/api/#py:accessing_rql-connect">opening a database connection</a> and 
<a href="http://www.rethinkdb.com/api/#py:accessing_rql-close">closing it</a> respectively.</p>
            </td>
            <td class=code>
                <div class='highlight'><pre><span class="nd">@bottle.hook</span><span class="p">(</span><span class="s">&#39;before_request&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">before_request</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;/static/&#39;</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">bottle</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">rdb_connection</span>  <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">RDB_HOST</span><span class="p">,</span> <span class="n">RDB_PORT</span><span class="p">,</span> <span class="n">TODO_DB</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">RqlDriverError</span><span class="p">:</span>
        <span class="n">bottle</span><span class="o">.</span><span class="n">abort</span><span class="p">(</span><span class="mi">503</span><span class="p">,</span> <span class="s">&quot;No database connection could be established.&quot;</span><span class="p">)</span>

<span class="nd">@bottle.hook</span><span class="p">(</span><span class="s">&#39;after_request&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">after_request</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;/static/&#39;</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="n">bottle</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">rdb_connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></pre></div>
            </td>
        </tr>
        <tr id='section-Listing_existing_todos'>
            <td class=docs>
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-Listing_existing_todos">&#182;</a>
                </div>
                <h3>Listing existing todos</h3>
            </td>
            <td class=code>
                <div class='highlight'><pre></pre></div>
            </td>
        </tr>
        <tr id='section-9'>
            <td class=docs>
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-9">&#182;</a>
                </div>
                <p>To retrieve all existing tasks, we use the
<a href="http://www.rethinkdb.com/api/#py:selecting_data-table"><code>r.table</code></a>
command to query the database in response to a GET request from the
browser. When <code>table(table_name)</code> isn&#39;t followed by an additional
command, it returns all documents in the table.</p>

<p>Running the query returns an iterator that automatically streams
data from the server in efficient batches.</p>
            </td>
            <td class=code>
                <div class='highlight'><pre><span class="nd">@bottle.get</span><span class="p">(</span><span class="s">&quot;/todos&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_todos</span><span class="p">():</span>
    <span class="n">selection</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s">&#39;todos&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">bottle</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">rdb_connection</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&#39;todos&#39;</span><span class="p">:</span> <span class="n">selection</span><span class="p">})</span></pre></div>
            </td>
        </tr>
        <tr id='section-Creating_a_todo'>
            <td class=docs>
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-Creating_a_todo">&#182;</a>
                </div>
                <h3>Creating a todo</h3>
            </td>
            <td class=code>
                <div class='highlight'><pre></pre></div>
            </td>
        </tr>
        <tr id='section-11'>
            <td class=docs>
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-11">&#182;</a>
                </div>
                <p>We will create a new todo in response to a POST request to <code>/todos</code>
with a JSON payload using
<a href="http://www.rethinkdb.com/api/#py:writing_data-insert"><code>table.insert</code></a>.</p>

<p>The <code>insert</code> operation returns a single object specifying the number
of successfully created objects and their corresponding IDs:
<code>{ &quot;inserted&quot;: 1, &quot;errors&quot;: 0, &quot;generated_keys&quot;: [&quot;773666ac-841a-44dc-97b7-b6f3931e9b9f&quot;] }</code></p>
            </td>
            <td class=code>
                <div class='highlight'><pre><span class="nd">@bottle.post</span><span class="p">(</span><span class="s">&quot;/todos&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">new_todo</span><span class="p">():</span>
    <span class="n">todo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;todo&#39;</span><span class="p">]</span>
    <span class="n">inserted</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s">&#39;todos&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">todo</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">bottle</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">rdb_connection</span><span class="p">)</span>
    <span class="n">todo</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inserted</span><span class="p">[</span><span class="s">&#39;generated_keys&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&#39;todo&#39;</span><span class="p">:</span> <span class="n">todo</span><span class="p">})</span></pre></div>
            </td>
        </tr>
        <tr id='section-Retrieving_a_single_todo'>
            <td class=docs>
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-Retrieving_a_single_todo">&#182;</a>
                </div>
                <h3>Retrieving a single todo</h3>
            </td>
            <td class=code>
                <div class='highlight'><pre></pre></div>
            </td>
        </tr>
        <tr id='section-13'>
            <td class=docs>
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-13">&#182;</a>
                </div>
                <p>Every new task gets assigned a unique ID. The browser can retrieve
a specific task by GETing <code>/todos/&lt;todo_id&gt;</code>. To query the database
for a single document by its ID, we use the
<a href="http://www.rethinkdb.com/api/#py:selecting_data-get"><code>get</code></a>
command.</p>

<p>Using a task&#39;s ID will prove more useful when we decide to update
it, mark it completed, or delete it.</p>
            </td>
            <td class=code>
                <div class='highlight'><pre><span class="nd">@bottle.get</span><span class="p">(</span><span class="s">&quot;/todos/&lt;todo_id&gt;&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_todo</span><span class="p">(</span><span class="n">todo_id</span><span class="p">):</span>
    <span class="n">todo</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s">&#39;todos&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">todo_id</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">bottle</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">rdb_connection</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&#39;todo&#39;</span><span class="p">:</span> <span class="n">todo</span><span class="p">})</span></pre></div>
            </td>
        </tr>
        <tr id='section-Editing/Updating_a_task'>
            <td class=docs>
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-Editing/Updating_a_task">&#182;</a>
                </div>
                <h3>Editing/Updating a task</h3>
            </td>
            <td class=code>
                <div class='highlight'><pre></pre></div>
            </td>
        </tr>
        <tr id='section-15'>
            <td class=docs>
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-15">&#182;</a>
                </div>
                <p>Updating a todo (editing it or marking it completed) is performed on
a <code>PUT</code> request.  To save the updated todo we&#39;ll do a
<a href="http://www.rethinkdb.com/api/#py:writing_data-replace"><code>replace</code></a>.</p>
            </td>
            <td class=code>
                <div class='highlight'><pre><span class="nd">@bottle.put</span><span class="p">(</span><span class="s">&quot;/todos/&lt;todo_id&gt;&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">update_todo</span><span class="p">(</span><span class="n">todo_id</span><span class="p">):</span>
    <span class="n">todo</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="n">todo_id</span><span class="p">}</span>
    <span class="n">todo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;todo&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s">&#39;todos&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">todo_id</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">todo</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">bottle</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">rdb_connection</span><span class="p">))</span></pre></div>
            </td>
        </tr>
        <tr id='section-16'>
            <td class=docs>
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-16">&#182;</a>
                </div>
                <p>If you&#39;d like the update operation to happen as the result of a
<code>PATCH</code> request (carrying only the updated fields), you can use the
<a href="http://www.rethinkdb.com/api/#py:writing_data-update"><code>update</code></a>
command, which will merge the JSON object stored in the database
with the new one.</p>
            </td>
            <td class=code>
                <div class='highlight'><pre><span class="nd">@bottle.route</span><span class="p">(</span><span class="s">&quot;/todos/&lt;todo_id&gt;&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;PATCH&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">patch_todo</span><span class="p">(</span><span class="n">todo_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s">&#39;todos&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">todo_id</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;todo&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">bottle</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">rdb_connection</span><span class="p">))</span></pre></div>
            </td>
        </tr>
        <tr id='section-Deleting_a_task'>
            <td class=docs>
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-Deleting_a_task">&#182;</a>
                </div>
                <h3>Deleting a task</h3>
            </td>
            <td class=code>
                <div class='highlight'><pre></pre></div>
            </td>
        </tr>
        <tr id='section-18'>
            <td class=docs>
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-18">&#182;</a>
                </div>
                <p>To delete a todo item we&#39;ll call a
<a href="http://www.rethinkdb.com/api/#py:writing_data-delete"><code>delete</code></a>
command on a <code>DELETE /todos/&lt;todo_id&gt;</code> request.</p>
            </td>
            <td class=code>
                <div class='highlight'><pre><span class="nd">@bottle.delete</span><span class="p">(</span><span class="s">&quot;/todos/&lt;todo_id&gt;&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">delete_todo</span><span class="p">(</span><span class="n">todo_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s">&#39;todos&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">todo_id</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">bottle</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">rdb_connection</span><span class="p">))</span>

<span class="nd">@bottle.get</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_todos</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">static_file</span><span class="p">(</span><span class="s">&#39;todo.html&#39;</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="s">&#39;templates/&#39;</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;text/html&#39;</span><span class="p">)</span>

<span class="nd">@bottle.route</span><span class="p">(</span><span class="s">&#39;/static/&lt;filename:path&gt;&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;GET&#39;</span><span class="p">)</span>
<span class="nd">@bottle.route</span><span class="p">(</span><span class="s">&#39;/static/&lt;filename:path&gt;&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;HEAD&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">send_static</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">static_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="s">&#39;static/&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">&#39;Run the Bottle todo app&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--setup&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;run_setup&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">run_setup</span><span class="p">:</span>
        <span class="n">dbSetup</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bottle</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">reloader</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div>
            </td>
        </tr>
        <tr id='section-Best_practices'>
            <td class=docs>
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-Best_practices">&#182;</a>
                </div>
                <h3>Best practices</h3>

<h4>Managing connections: a connection per request</h4>

<p>The RethinkDB server doesn&#39;t use a thread-per-connnection approach
so opening connections per request will not slow down your database.</p>

<h4>Fetching multiple rows: batched iterators</h4>

<p>When fetching multiple rows from a table, RethinkDB returns a
batched iterator initially containing a subset of the complete
result. Once the end of the current batch is reached, a new batch is
automatically retrieved from the server. From a coding point of view
this is transparent:</p>

<pre><code>for result in r.table(&#39;todos&#39;).run(connection):
    print result
</code></pre>

<h4><code>replace</code> vs <code>update</code></h4>

<p>Both <code>replace</code> and <code>update</code> operations can be used to modify one or
multiple rows. Their behavior is different:</p>

<ul>
<li>  <code>replace</code> will completely replace the existing rows with new values</li>
<li>  <code>update</code> will merge existing rows with the new values</li>
</ul>
            </td>
            <td class=code>
                <div class='highlight'><pre></pre></div>
            </td>
        </tr>
        <tr id='section-20'>
            <td class=docs>
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-20">&#182;</a>
                </div>
                <p>Licensed under the MIT license: <a href="http://opensource.org/licenses/mit-license.php">http://opensource.org/licenses/mit-license.php</a></p>

<p>Copyright &copy; 2012 RethinkDB</p>

            </td>
            <td class=code>
                <div class='highlight'><pre></pre></div>
            </td>
        </tr>
    </tbody>
</table>
